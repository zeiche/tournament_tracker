; Polymorphic Asterisk Dialplan
; Everything routes to Claude AGI - it figures out what you want

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Claude AGI path
CLAUDE_AGI=/home/ubuntu/claude/tournament_tracker/polymorphic_core/telephony/asterisk_agi.py

[default]
; Catch all - everything goes to Claude
exten => _X.,1,Answer()
 same => n,Wait(1)
 same => n,AGI(${CLAUDE_AGI})
 same => n,Hangup()

[claude-direct]
; Direct line to Claude - call extension 2583 (CLUD on phone keypad)
exten => 2583,1,Answer()
 same => n,Playback(beep)
 same => n,AGI(${CLAUDE_AGI})
 same => n,Hangup()

[incoming]
; All incoming calls go to Claude
exten => s,1,Answer()
 same => n,Wait(1)
 same => n,AGI(${CLAUDE_AGI})
 same => n,Hangup()

; DID routing - if you have a phone number
exten => _+1NXXNXXXXXX,1,Goto(incoming,s,1)
exten => _1NXXNXXXXXX,1,Goto(incoming,s,1)
exten => _NXXNXXXXXX,1,Goto(incoming,s,1)

[internal]
; Internal extensions
exten => 100,1,Goto(claude-direct,2583,1)  ; Extension 100 -> Claude

; Voice mail to Claude (records, transcribes, and processes)
exten => *98,1,Answer()
 same => n,Playback(vm-intro)
 same => n,AGI(${CLAUDE_AGI})
 same => n,Hangup()

[claude-services]
; Different Claude modes via different extensions
exten => 1000,1,Set(CLAUDE_MODE=chat)
 same => n,Goto(claude-direct,2583,1)

exten => 1001,1,Set(CLAUDE_MODE=tournament)
 same => n,Goto(claude-direct,2583,1)

exten => 1002,1,Set(CLAUDE_MODE=tech_support)
 same => n,Goto(claude-direct,2583,1)

[emergency]
; Don't handle emergency calls - pass through
exten => 911,1,Dial(PJSIP/911@voip-provider)
exten => 112,1,Dial(PJSIP/112@voip-provider)